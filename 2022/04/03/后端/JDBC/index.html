<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="JDBC1、JDBC介绍根据Oracle的声明，JDBC是一个注册了商标的术语，而并非 Java DataBase Connectivity 的首字母缩写。对它的命名体现了对ODBC的致敬，后者是微软开创的标准数据库API，为C语言访问数据库提供了一套编程接口，并因此并入了SQL标准中。JDBC和ODBC都基于同一个思想： ​	根据API编写的程序都可以与驱动管理器进行通信，而驱动管理器则通过驱动">
<meta property="og:type" content="article">
<meta property="og:title" content="JDBC">
<meta property="og:url" content="https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/index.html">
<meta property="og:site_name" content="Yumo&#39;s Blog">
<meta property="og:description" content="JDBC1、JDBC介绍根据Oracle的声明，JDBC是一个注册了商标的术语，而并非 Java DataBase Connectivity 的首字母缩写。对它的命名体现了对ODBC的致敬，后者是微软开创的标准数据库API，为C语言访问数据库提供了一套编程接口，并因此并入了SQL标准中。JDBC和ODBC都基于同一个思想： ​	根据API编写的程序都可以与驱动管理器进行通信，而驱动管理器则通过驱动">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-143240.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-154850.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-142937.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-155125_magic.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-155309_magic.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194306951.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194408869.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194638729.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194916147.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404195046149.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404195555654.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-04-210506.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-05-183425.png">
<meta property="og:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-05-194841.png">
<meta property="article:published_time" content="2022-04-03T08:51:33.000Z">
<meta property="article:modified_time" content="2023-09-29T06:14:37.350Z">
<meta property="article:author" content="Yumo">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="Database">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-143240.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/android-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>JDBC</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Archives</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/categories/">Categorys</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/04/12/linux/Linux%E5%9F%BA%E7%A1%80/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/03/18/Java/%E5%B9%B6%E5%8F%91/%E5%B9%B6%E5%8F%91/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&text=JDBC"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&is_video=false&description=JDBC"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JDBC&body=Check out this article: https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&name=JDBC&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&t=JDBC"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JDBC"><span class="toc-number">1.</span> <span class="toc-text">JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81JDBC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1、JDBC介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81JDBC%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1、JDBC驱动程序类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81JDBC%E7%9A%84%E5%85%B8%E5%9E%8B%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2、JDBC的典型用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3、结构化查询语言</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81JDBC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">2、JDBC配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8FJAR%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">驱动程序JAR文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">配置：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%BC%80%E5%90%AFMysql%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">1、开启Mysql服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81JDBC%E9%93%BE%E6%8E%A5"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2、JDBC链接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81JDBC%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.3.</span> <span class="toc-text">3、JDBC程序编写步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAconnection"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResultSet%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">ResultSet结果集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Statement%E5%92%8CSQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.3.</span> <span class="toc-text">Statement和SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PreparedStatement"><span class="toc-number">1.3.4.</span> <span class="toc-text">PreparedStatement</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-2"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC-API"><span class="toc-number">1.3.5.</span> <span class="toc-text">JDBC API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99JDBCUtils%E7%B1%BB"><span class="toc-number">1.3.6.</span> <span class="toc-text">编写JDBCUtils类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">测试代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.4.</span> <span class="toc-text">4、事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">5、批处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#addBatch%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB"><span class="toc-number">1.5.3.</span> <span class="toc-text">addBatch源码解读</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.6.</span> <span class="toc-text">6、连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E8%8E%B7%E5%8F%96Connection%E5%BC%8A%E7%AB%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.6.1.</span> <span class="toc-text">传统获取Connection弊端分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.6.2.</span> <span class="toc-text">数据库连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%A7%8D%E7%B1%BB"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">数据库连接池种类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%B7%E9%B2%81%E4%BC%8A%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.6.3.</span> <span class="toc-text">德鲁伊连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-5"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">编写工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">测试代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache-DBUtils"><span class="toc-number">1.6.4.</span> <span class="toc-text">Apache-DBUtils</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E5%B0%81%E8%A3%85"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">传统封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-6"><span class="toc-number">1.6.4.2.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache-DBUtils%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.5.</span> <span class="toc-text">Apache-DBUtils介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-7"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.6.5.1.1.</span> <span class="toc-text">源码分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">异常处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BasicDao"><span class="toc-number">1.6.6.</span> <span class="toc-text">BasicDao</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">基本说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-8"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        JDBC
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Yumo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-04-03T08:51:33.000Z" class="dt-published" itemprop="datePublished">2022-04-03</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Database/" rel="tag">Database</a>, <a class="p-category" href="/tags/Java/" rel="tag">Java</a>, <a class="p-category" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><h2 id="1、JDBC介绍"><a href="#1、JDBC介绍" class="headerlink" title="1、JDBC介绍"></a>1、JDBC介绍</h2><p>根据<strong>Oracle</strong>的声明，<strong>JDBC</strong>是一个注册了商标的术语，而并非 <strong>Java DataBase Connectivity</strong> 的首字母缩写。对它的命名体现了对<strong>ODBC</strong>的致敬，后者是微软开创的标准数据库API，为<strong>C语言</strong>访问数据库提供了一套编程接口，并因此并入了<strong>SQL</strong>标准中。JDBC和ODBC都基于同一个思想：</p>
<p>​	<strong>根据API编写的程序都可以与驱动管理器进行通信，而驱动管理器则通过驱动程序与实际的数据库进行通信。</strong></p>
<h3 id="1-1、JDBC驱动程序类型"><a href="#1-1、JDBC驱动程序类型" class="headerlink" title="1.1、JDBC驱动程序类型"></a>1.1、JDBC驱动程序类型</h3><p>JDBC规范将驱动程序归结为以下几类：</p>
<ul>
<li><em>第1类驱动程序</em>将JDBC翻译成ODBC，然后用ODBC驱动程序与数据库进行通信。较早版本的Java包包含了这样一个驱动程序：<strong>JDBC&#x2F;ODBC桥</strong>，不过在使用这个桥接器之前需要对ODBC进行相应的部署和正确的设置。在JDBC面世之初，桥接器可以方便地用于测试，却不太适用于产品的开发。现在有更好的驱动程序可以使用，所以JDK已经不再提供JDBC&#x2F;ODBC桥了</li>
<li><em>第2类驱动程序</em>是<strong>由部分Java程序和部分本地代码</strong>组成的，用于<strong>与数据库的客户端API进行通信</strong>。在使用这个驱动程序之前，客户端不仅需要安装Java类库，还需要安装一些与平台相关的代码</li>
<li><em>第3类驱动程序</em>是<strong>纯Java客户端类库</strong>，它使用一种<strong>与具体数据库无关的协议</strong>将<strong>数据库请求</strong>发送给<strong>服务器构建</strong>，然后该构建再将数<strong>据库请求翻译成数据库相关的协议</strong>。这简化了部署，因为平台相关的代码只位于服务器端。</li>
<li><em>第4类驱动程序</em>是<strong>纯Java类库</strong>，它将<strong>JDBC请求</strong>直接<strong>翻译</strong>成<strong>数据库相关的协议</strong>。</li>
</ul>
<p>大部分数据库供应商都为他们的产品提供第3或第4类驱动程序。总之，JDBC最终是为了实现以下目标：</p>
<ul>
<li>通过使用标准的SQL语句，甚至是专门的SQL扩展，程序员就可以利用Java语言开发访问数据库的应用，同时还依旧遵守Java语言的相关协定。</li>
<li>数据库供应商和数据库工具开发商可以提供底层的驱动程序。因此，他们可以优化各自数据库产品的驱动程序。</li>
</ul>
<h3 id="1-2、JDBC的典型用法"><a href="#1-2、JDBC的典型用法" class="headerlink" title="1.2、JDBC的典型用法"></a>1.2、JDBC的典型用法</h3><p>在传统的<strong>客户端&#x2F;服务器模型</strong>中，通常是在服务器端部署数据库，而在客户端安装富GUI程序。在此模型中，<strong>JDBC驱动程序应该部署在客户端</strong>。如下图所示：</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-143240.png"></p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-154850.png"></p>
<p>但是如今<strong>三层模型</strong>更加常见。在三层应用模型中，客户端不直接调用数据库，而是调用<strong>服务器</strong>上的<strong>中间件层</strong>，由中间件完成数据库查询操作。这种三层模型有以下优点：它将<em><strong>可视化表示</strong></em>（位于客户端）从<em><strong>业务逻辑</strong></em>（位于中间层）和<em><strong>原始数据</strong></em>（位于数据库）中分离出来。因此我们可以从不同的客户端，如Java桌面应用、浏览器或者移动APP，来访问相同的数据和相同的业务规则。</p>
<p>客户端和中间层之间的通信在典型情况下是通过<strong>HTTP</strong>来实现的。JDBC管理着<strong>中间层</strong>和<strong>后台数据库</strong>之间的<strong>通信</strong>，下图展示了这种通信模型的基本架构。</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-142937.png"></p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-155125_magic.png"></p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-03-155309_magic.png"></p>
<h3 id="1-3、结构化查询语言"><a href="#1-3、结构化查询语言" class="headerlink" title="1.3、结构化查询语言"></a>1.3、结构化查询语言</h3><p>SQL是对所有现代关系型数据库都至关重要的命令行语言，JDBC则使得我们可以通过SQL与数据库进行通信。桌面数据库通常都有一个图形化用户界面：通过这种界面，用户可以直接操作数据。但是，基于服务器的数据库只能使用SQL进行访问。</p>
<p>我们可以将JDBC包看作一个用于将SQL语句传递给数据库的应用编程接口（API）</p>
<h2 id="2、JDBC配置"><a href="#2、JDBC配置" class="headerlink" title="2、JDBC配置"></a>2、JDBC配置</h2><p>本文章使用的是mysql8.0.28</p>
<h3 id="驱动程序JAR文件"><a href="#驱动程序JAR文件" class="headerlink" title="驱动程序JAR文件"></a>驱动程序JAR文件</h3><p><strong>mysql-connector-java的jar包：</strong></p>
<p>maven添加jar包依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h3><h4 id="1、开启Mysql服务"><a href="#1、开启Mysql服务" class="headerlink" title="1、开启Mysql服务"></a>1、开启Mysql服务</h4><p>以管理员身份运行命令提示符，输入 <code>net start mysql80</code> <strong>开启mysql服务</strong> ，mysql80是安装的时候，设置的服务名。<br>输入 <code>net stop mysql80</code> <strong>关闭mysql服务</strong> 。</p>
<p>开启mysql服务后就可以关闭cmd框，然后开始写代码了。</p>
<h4 id="2、JDBC链接"><a href="#2、JDBC链接" class="headerlink" title="2、JDBC链接"></a>2、JDBC链接</h4><p>通常情况下连接url设置成这样即可：<br>    协议名:&#x2F;&#x2F;IP地址:端口号&#x2F;数据库名?参数1&amp;参数2&amp;…</p>
<p>​	jdbc:<em>subprotocol</em>:<em>other stuff</em></p>
<p>其中<em>subprotocol</em>用于选择连接到数据库的基本驱动程序，<em>other stuff</em>参数的格式随使用的<em>subprotocol</em>不同而不同。</p>
<p>例如：<br>    jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;databaseName?useSSL&#x3D;false&amp;serverTimezone&#x3D;UTC&amp;characterEncoding&#x3D;UTF-8</p>
<p>详解：</p>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>jdbc:mysql</td>
<td>协议</td>
</tr>
<tr>
<td>localhost:3306</td>
<td>localhost是本机地址127.0.0.1 ， 3306 端口名，是mysql开启的服务，如果上述的mysql服务未开启，会报 <code>com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure </code>的异常</td>
</tr>
<tr>
<td>databaseName</td>
<td>数据库的名字，如果没有此数据库会报<code>SQLSyntaxErrorException: Unknown database &#39;xxx&#39;</code>，的异常</td>
</tr>
<tr>
<td>useSSL&#x3D;false</td>
<td>在web领域要用到，指是否开启ssl安全连接，但MySQL 8.0 以上版本不需要建立 SSL 连接，需要关闭。</td>
</tr>
<tr>
<td>serverTimezone&#x3D;UTC</td>
<td>设置时区</td>
</tr>
<tr>
<td>characterEncoding&#x3D;UTF-8</td>
<td>设置编码格式，不设置很可能造成乱码。</td>
</tr>
</tbody></table>
<h2 id="3、JDBC程序编写步骤"><a href="#3、JDBC程序编写步骤" class="headerlink" title="3、JDBC程序编写步骤"></a>3、JDBC程序编写步骤</h2><p>1、注册驱动-加载Driver类</p>
<p>2、获取连接-得到Connection</p>
<p>3、执行增删改查-发送SQL给mysql执行</p>
<p>4、释放资源-关闭相关连接</p>
<h4 id="示例程序"><a href="#示例程序" class="headerlink" title="示例程序"></a>示例程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> com.mysql.cj.jdbc.Driver;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBC01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.注册驱动</span></span><br><span class="line">        <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Driver</span>();</span><br><span class="line">        <span class="comment">//2.得到连接</span></span><br><span class="line">        <span class="comment">//(1) jdbc:mysql://  规定好表示协议，通过jdbc的方式连接mysql</span></span><br><span class="line">        <span class="comment">//(2) localhost  主机，可以是IP地址</span></span><br><span class="line">        <span class="comment">//(3) 3306  表示mysql监听的端口</span></span><br><span class="line">        <span class="comment">//(4) crashcourse 连接到mysql dbms的哪个数据库</span></span><br><span class="line">        <span class="comment">//(5) mysql的连接本质就是 socket 连接</span></span><br><span class="line"></span><br><span class="line">        String url=<span class="string">&quot;jdbc:mysql://localhost:3306/crashcourse?serverTimezone=GMT&quot;</span>;</span><br><span class="line">        <span class="comment">//将用户名和密码放入到Properties对象</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//说明user 和 password 是规定好，后面的值根据实际情况写</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;168178&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> driver.connect(url, properties);</span><br><span class="line">        <span class="comment">//3.执行sql</span></span><br><span class="line">        String sql=<span class="string">&quot;INSERT INTO actor VALUES (null ,&#x27;刘德华&#x27;,&#x27;男&#x27;,&#x27;1970-11-11&#x27;,&#x27;110&#x27;)&quot;</span>;</span><br><span class="line">        <span class="comment">//statement 用于执行静态SQL语句并返回其生成的结果的对象</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connect.createStatement();</span><br><span class="line">        <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> statement.executeUpdate(sql);<span class="comment">// 返回影响的行数</span></span><br><span class="line"></span><br><span class="line">        System.out.println(rows&gt;<span class="number">0</span>?<span class="string">&quot;成功&quot;</span>:<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="comment">//4.关闭连接资源</span></span><br><span class="line">        statement.close();</span><br><span class="line">        connect.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建connection"><a href="#创建connection" class="headerlink" title="创建connection"></a>创建connection</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mysql.cj.jdbc.Driver;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCConn</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *直接使用com.mysql.cj.jdbc.Driver(),属于静态加载，灵活性差，依赖强</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect01</span><span class="params">()</span><span class="keyword">throws</span> SQLException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//直接使用com.mysql.cj.jdbc.Driver(),属于静态加载，灵活性差，依赖强</span></span><br><span class="line">        <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Driver</span>();</span><br><span class="line">        String url=<span class="string">&quot;jdbc:mysql://localhost:3306/crashcourse?serverTimezone=GMT&quot;</span>;</span><br><span class="line">        <span class="comment">//将用户名和密码放入到Properties对象</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//说明user 和 password 是规定好，后面的值根据实际情况写</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;168178&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> driver.connect(url, properties);</span><br><span class="line">        System.out.println(connect);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用反射加载Driver类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect02</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, ClassNotFoundException, InvocationTargetException, InstantiationException, IllegalAccessException, SQLException &#123;</span><br><span class="line">        <span class="comment">//使用反射加载Driver类，动态加载，减少依赖性</span></span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        Driver driver=(Driver) aClass.getDeclaredConstructor().newInstance();</span><br><span class="line"></span><br><span class="line">        String url=<span class="string">&quot;jdbc:mysql://localhost:3306/crashcourse?serverTimezone=GMT&quot;</span>;</span><br><span class="line">        <span class="comment">//将用户名和密码放入到Properties对象</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//说明user 和 password 是规定好，后面的值根据实际情况写</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;168178&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connect</span> <span class="operator">=</span> driver.connect(url, properties);</span><br><span class="line">        System.out.println(connect);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *方式3：使用反射加载Driver类，使用DriverManager进行统一管理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect03</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//使用反射加载Driver类，动态加载，减少依赖性</span></span><br><span class="line">        Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        Driver driver=(Driver) aClass.getDeclaredConstructor().newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建 url 和 user 和 password</span></span><br><span class="line">        String url=<span class="string">&quot;jdbc:mysql://localhost:3306/crashcourse?serverTimezone=GMT&quot;</span>;</span><br><span class="line">        String user=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password=<span class="string">&quot;168178&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用DriverManager进行统一管理</span></span><br><span class="line">        <span class="comment">//注册Driver驱动</span></span><br><span class="line">        DriverManager.registerDriver(driver);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *方式4：使用Class.forName 自动完成注册驱动，简化代码</span></span><br><span class="line"><span class="comment">     * 这种方式获取连接推荐使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用反射加载Driver类，动态加载，减少依赖性</span></span><br><span class="line">        <span class="comment">//在加载 Driver类时，自动完成注册</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 源码：1、静态代码快。在类加载时，会执行一次</span></span><br><span class="line"><span class="comment">         * 2、java.sql.DriverManager.registerDriver(new Driver());</span></span><br><span class="line"><span class="comment">         * 3、因此注册driver的工作语句完成</span></span><br><span class="line"><span class="comment">         * static &#123;</span></span><br><span class="line"><span class="comment">         *         try &#123;</span></span><br><span class="line"><span class="comment">         *             java.sql.DriverManager.registerDriver(new Driver());</span></span><br><span class="line"><span class="comment">         *         &#125; catch (SQLException E) &#123;</span></span><br><span class="line"><span class="comment">         *             throw new RuntimeException(&quot;Can&#x27;t register driver!&quot;);</span></span><br><span class="line"><span class="comment">         *         &#125;</span></span><br><span class="line"><span class="comment">         *     &#125;</span></span><br><span class="line"><span class="comment">         * mysqL驱动5.1.6可以无需CLass . forName(&quot;com.mysql.jdbc.Driver&quot;);</span></span><br><span class="line"><span class="comment">         * 从jdk1.5以后使用了jdbc4,不再需要显示调用class.forName()注册驱动而是自动调用驱动jar包下META-INF\servicesVjava .sqI.Driver文本中的类名称去注册</span></span><br><span class="line"><span class="comment">         * 建议还是写上类。ForName(“com.mysql.jdbc.Driver”)，更加明确</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建 url 和 user 和 password</span></span><br><span class="line">        String url=<span class="string">&quot;jdbc:mysql://localhost:3306/crashcourse?serverTimezone=GMT&quot;</span>;</span><br><span class="line">        String user=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password=<span class="string">&quot;168178&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方式5，在方式4的基础上改进，增加配置文件，让连接mysql更加灵活</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect05</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, SQLException &#123;</span><br><span class="line">        <span class="comment">//通过Properties对象获取配置文件的信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/javabase/jdbc/database.properties&quot;</span>));</span><br><span class="line">        <span class="comment">//获取相关的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.driver&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.url&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ResultSet结果集"><a href="#ResultSet结果集" class="headerlink" title="ResultSet结果集"></a>ResultSet结果集</h3><p>表示数据库结果集的数据表，通常通过执行查询数据库的语句生成.</p>
<p>ResultSet对象保持一个光标指向其当前的数据行。最初，光标位于第一行之前。next方法将光标移动到下一行，并且由于在ResultSet对象中没有更多行时返回false。因此可以在while循环中使用循环来遍历结果集。</p>
<blockquote>
<p><strong>警告</strong>：ResultSet接口的迭代协议与java.util.Iterator接口稍有不同。对于ResultSet接口，迭代器初始化时被设定在第一行之前的位置，必须调用next方法将它移动到第一行。另外，它没有hasNext方法，我们需要不断地调用next，直至该方法返回false。</p>
</blockquote>
<h3 id="Statement和SQL注入"><a href="#Statement和SQL注入" class="headerlink" title="Statement和SQL注入"></a>Statement和SQL注入</h3><p>Statement对象用于执行<strong>静态SQL语</strong>句并返回其生成的结果的对象。</p>
<p>在连接建立后，需要对数据库进行访问，执行命名或是SQL语句，可以通过：</p>
<ul>
<li><strong>Statement</strong>[存在SQL注入 ]</li>
<li><strong>PreparedStatement</strong>[预处理]</li>
<li><strong>CallableStatement</strong>[存储过程]</li>
</ul>
<p>Statement对象执行SQL语句，存在<strong>SQL注入</strong>风险。</p>
<p><strong>SQL注入</strong>是利用某些系统没有对用户输入的数据进行充分的检查，而在用户输入数据中注入非法的SQL语句段或命令，恶意攻击数据库。</p>
<p>要防范SQL注入，只要用<strong>PreparedStatement</strong>取代Statement就可以了。</p>
<p>演示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> admin (</span><br><span class="line">	name <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">	pwd <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">)<span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8; </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> admin <span class="keyword">VALUES</span>(&quot;tom&quot;,&quot;123&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">		<span class="keyword">FROM</span> admin</span><br><span class="line">		<span class="keyword">WHERE</span> NAME<span class="operator">=</span><span class="string">&#x27;tom&#x27;</span> <span class="keyword">AND</span> pwd <span class="operator">=</span><span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>正常情况下该select语句将会成功返回对应的数据。</p>
<p>若使  用户名为  <strong>1’ or</strong> </p>
<p>​          密码为    <strong>or ‘1’ &#x3D;1’</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">		<span class="keyword">FROM</span> admin</span><br><span class="line">		<span class="keyword">WHERE</span> NAME<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">or</span><span class="string">&#x27; AND pwd =&#x27;</span><span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这种情况也会返回数据</p>
<h4 id="示例程序-1"><a href="#示例程序-1" class="headerlink" title="示例程序"></a>示例程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 演示Statement的SQL注入问题</span></span><br><span class="line"><span class="comment"> * name = 1&#x27; or</span></span><br><span class="line"><span class="comment"> * psw = or &#x27;1&#x27;=&#x27;1    万能密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Statement_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, SQLException &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//让用户输入管理员名和密码</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入管理员的名字: &quot;</span>);</span><br><span class="line">        String admin_name=scanner.nextLine();<span class="comment">//next 不读取空格</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入管理员的密码: &quot;</span>);</span><br><span class="line">        String admin_pwd=scanner.nextLine();</span><br><span class="line">        <span class="comment">//通过Properties对象获取配置文件的信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/javabase/jdbc/database.properties&quot;</span>));</span><br><span class="line">        <span class="comment">//获取相关的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.driver&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.url&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、得到statement</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.组织SQL</span></span><br><span class="line">        String sql=<span class="string">&quot;SELECT name,pwd FROM admin WHERE name=&#x27;&quot;</span></span><br><span class="line">                +admin_name+<span class="string">&quot;&#x27; and pwd=&#x27;&quot;</span>+admin_pwd+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        ResultSet resultSet=statement.executeQuery(sql);</span><br><span class="line">        <span class="keyword">if</span> (resultSet.next())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> System.out.println(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">        resultSet.close();</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h3><p>1、PreparedStatement执行的SQL语句中的参数用<strong>问号(?)<strong>来表示，调用PreparedStatement对象的</strong>setXxx()<strong>方法来设置这些参数,setXxx()方法有两个参数，第一个参数是要设置的SQL语句中参数的</strong>索引（从1开始）</strong>，第二个是设置的SQL语句中的<strong>参数的值</strong></p>
<p>2、调用executeQuery()，返回ResultSet对象</p>
<p>3、调用executeUpdate()，执行更新</p>
<p>预处理好处：</p>
<p>1、不再使用+拼接SQL语句，减少语法错误</p>
<p>2、有效的解决了SQL注入问题</p>
<p>3、大大减少了编译次数，效率较高</p>
<h4 id="示例程序-2"><a href="#示例程序-2" class="headerlink" title="示例程序"></a>示例程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 演示PreparedStatement</span></span><br><span class="line"><span class="comment"> * name = 1&#x27; or</span></span><br><span class="line"><span class="comment"> * psw = or &#x27;1&#x27;=&#x27;1    万能密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PreparedStatement_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//让用户输入管理员名和密码</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入管理员的名字: &quot;</span>);</span><br><span class="line">        String admin_name=scanner.nextLine();<span class="comment">//next 不读取空格</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入管理员的密码: &quot;</span>);</span><br><span class="line">        String admin_pwd=scanner.nextLine();</span><br><span class="line">        <span class="comment">//通过Properties对象获取配置文件的信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/javabase/jdbc/database.properties&quot;</span>));</span><br><span class="line">        <span class="comment">//获取相关的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.user&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.driver&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;jdbc.url&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, user, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.组织SQL,   ?  相当于占位符</span></span><br><span class="line">        String sql=<span class="string">&quot;SELECT name,pwd FROM admin WHERE name=? and pwd=?&quot;</span>;</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">        <span class="comment">//3、preparedStatement对象实现了PreparedStatement接口的实现类的镀锡</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line">        <span class="comment">//给 ? 赋值</span></span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>,admin_name);</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>,admin_pwd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//这里执行查询时不写sql</span></span><br><span class="line">        ResultSet resultSet=preparedStatement.executeQuery();</span><br><span class="line">        <span class="keyword">if</span> (resultSet.next())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> System.out.println(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">        resultSet.close();</span><br><span class="line">        preparedStatement.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDBC-API"><a href="#JDBC-API" class="headerlink" title="JDBC API"></a>JDBC API</h3><p>1、Driver  DriverManager</p>
<p>registerDriver(Driver driver):在DriverManager中注册jdbc驱动器。（一般不使用） 因为在DriverManager类中已经有了一个静态代码块已经调用了所以我们在工作中一般使用</p>
<p>Class.forName(“com.mysql.jdbc.Driver”)</p>
<p>deregister(Driver driver):在DriverManager中注销jdbc驱动器。</p>
<p>setLoginTimeOut(int seconds): 设定等待建立数据库连接的超时时间。</p>
<p>setLoginWriter(PrintWriter out) : 设定输出JDBC日志的PrintWriter对象。</p>
<p>getConnection(url,user,pwd)建立一个到指定数据库的连接，并返回一个Connection对象</p>
<p>2、Connection</p>
<p>​	createStatement()创建Statement对象</p>
<p>​	prepareStatement(String  sql)生成预处理对象</p>
<p>​	close() 立即关闭当前的连接，并释放由它所创建的JDBC资源</p>
<p>3、Statement</p>
<p>​	executeQuery(String sql)执行查询，返回ResultSet对象</p>
<p>​	executeUpdate(String sql)执行DML语句，返回受影响的行数</p>
<p>​	executeLargeUpdate(String sql)执行DML语句，返回受影响的行数</p>
<p>​	execute(String sql)执行任意sql，结果为结果集则返回true,否则返回false</p>
<p>​	getResultSet()返回前一条查询语句的结果集，若前一条未产生结果集则返回null。对于每一条被执行过的语句，该方法只能被调用一次</p>
<p>​	getUpdateCount()返回前一条更新语句影响的行数，若前一条未更新数据库，则返回-1。对于每一条被执行过的语句，该方法只能被调用一次</p>
<p>​	close()关闭该语句对象及其对应的结果集</p>
<p>​	isClosed()如果该语句被关闭则返回true</p>
<p>​	closeOnCompletion()一旦该语句的所有结果集都被关闭，则关闭该语句</p>
<p>4、PreparedStatement</p>
<p>​	setXxx(int n,Xxx x)设置第n个参数值为x</p>
<p>​	clearParameters()清楚预备语句的所有当前参数</p>
<p>​	executeQuery()执行预备sql查询，并返回一个ResultSet对象</p>
<p>​	executeUpdate()执行dml语句，返回受影响的记录总数。若执行数据定义语言(DDL)如CREATE TABLE，则返回0</p>
<p>5、ResultSet</p>
<p>​	next()向下移动一行，若没有下一行则返回false</p>
<p>​	previous()向上移动一行，若没有上一行则返回false</p>
<p>​	getXxx(int columnNumber)</p>
<p>​	getXxx(String columnLabel)</p>
<p>​	getObject(int columnNumber,Class&lt; T &gt; type )</p>
<p>​	getObject(String columnLabel，Class&lt; T &gt; type )</p>
<p>​	用给定的列序号或列名返回该列的值，并将值转换成指定的类型</p>
<p>​	findColumn(String columnName)根据给定的列名返回该列的序号</p>
<p>​	close()立即关闭当前的结果集</p>
<p>​	isClosed()若该语句被关闭则返回true</p>
<h3 id="编写JDBCUtils类"><a href="#编写JDBCUtils类" class="headerlink" title="编写JDBCUtils类"></a>编写JDBCUtils类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yumo</span></span><br><span class="line"><span class="comment"> * 这是一个工具类，完成mysql的连接和关闭资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义相关的属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在static代码块去初始化</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/javabase/jdbc/database.properties&quot;</span>));</span><br><span class="line">            <span class="comment">//获取相关的值</span></span><br><span class="line">             user = properties.getProperty(<span class="string">&quot;jdbc.user&quot;</span>);</span><br><span class="line">             password = properties.getProperty(<span class="string">&quot;jdbc.password&quot;</span>);</span><br><span class="line">             driver = properties.getProperty(<span class="string">&quot;jdbc.driver&quot;</span>);</span><br><span class="line">             url = properties.getProperty(<span class="string">&quot;jdbc.url&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">//在实际开发中</span></span><br><span class="line">            <span class="comment">//1、将编译异常转成运行异常</span></span><br><span class="line">            <span class="comment">//2、调用者可以选择捕获该异常，也可以选择默认处理该异常，比较方便</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> DriverManager.getConnection(url,user,password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet set, Statement statement,Connection connection)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//判断是否为null</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (set != <span class="literal">null</span>) &#123;</span><br><span class="line">                set.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;<span class="keyword">catch</span> (SQLException e)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtils_Use</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDML</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组织一个sql</span></span><br><span class="line">        String sql=<span class="string">&quot;update actor set name =? where  id =?&quot;</span>;</span><br><span class="line">        PreparedStatement preparedStatement=<span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//创建PreparedStatement对象</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            preparedStatement=connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>,<span class="string">&quot;周星驰&quot;</span>);</span><br><span class="line">            preparedStatement.setInt(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtils.close(<span class="literal">null</span>,preparedStatement,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组织一个sql</span></span><br><span class="line">        String sql=<span class="string">&quot;select * from actor&quot;</span>;</span><br><span class="line">        PreparedStatement preparedStatement=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//创建PreparedStatement对象</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            preparedStatement=connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">           resultSet = preparedStatement.executeQuery();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next())</span><br><span class="line">            &#123;</span><br><span class="line">                System.out.println(resultSet.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtils.close(resultSet,preparedStatement,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、事务"><a href="#4、事务" class="headerlink" title="4、事务"></a>4、事务</h2><p>基本介绍：</p>
<p>事务<br>基本介绍<br>1、JDBC程序中当一个Connection对象创建时，默认情况下是自动提交事务:每次执行一个SQL语句时，如果执行成功，就会向数据库自动提交，而不能回滚.</p>
<p>2、JDBC程序中为了让多个SQL语句作为一个整体执行，需要使用事务</p>
<p>3、调用Connection的 setAutoCommit(false)可以取消自动提交事务</p>
<p>4、在所有的SQL语句都成功执行后，调用Connection的commit();方法提交事务</p>
<p>5、在其中某个操作失败或出现异常时，调用Connection 的rollback();方法回滚事务</p>
<h3 id="示例程序-3"><a href="#示例程序-3" class="headerlink" title="示例程序"></a>示例程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.utils.JDBCUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Transaction_</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">noTransaction</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组织一个sql</span></span><br><span class="line">        String sql=<span class="string">&quot;update acc set balance =balance-100 where  id =1&quot;</span>;</span><br><span class="line">        String sql2=<span class="string">&quot;update acc set balance =balance+100 where  id =2&quot;</span>;</span><br><span class="line"></span><br><span class="line">        PreparedStatement preparedStatement=<span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//创建PreparedStatement对象</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();<span class="comment">//在默认情况下，connection默认提交</span></span><br><span class="line">            preparedStatement=connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> i=<span class="number">1</span>/<span class="number">0</span>;<span class="comment">//抛出异常</span></span><br><span class="line"></span><br><span class="line">            preparedStatement=connection.prepareStatement(sql2);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtils.close(<span class="literal">null</span>,preparedStatement,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useTransaction</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组织一个sql</span></span><br><span class="line">        String sql=<span class="string">&quot;update acc set balance =balance-100 where  id =1&quot;</span>;</span><br><span class="line">        String sql2=<span class="string">&quot;update acc set balance =balance+100 where  id =2&quot;</span>;</span><br><span class="line"></span><br><span class="line">        PreparedStatement preparedStatement=<span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//创建PreparedStatement对象</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();<span class="comment">//在默认情况下，connection默认提交</span></span><br><span class="line">            <span class="comment">//将connection设置为不自动提交</span></span><br><span class="line">            connection.setAutoCommit(<span class="literal">false</span>);<span class="comment">//开启了事务</span></span><br><span class="line">            preparedStatement=connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> i=<span class="number">1</span>/<span class="number">0</span>;<span class="comment">//抛出异常</span></span><br><span class="line"></span><br><span class="line">            preparedStatement=connection.prepareStatement(sql2);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//这里提交事务</span></span><br><span class="line">            connection.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里进行回滚，即撤销执行的sql</span></span><br><span class="line">            <span class="comment">//默认回滚到事务开始的状态</span></span><br><span class="line">            System.out.println(<span class="string">&quot;执行发生了异常，撤销执行的sql&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.rollback();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtils.close(<span class="literal">null</span>,preparedStatement,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5、批处理"><a href="#5、批处理" class="headerlink" title="5、批处理"></a>5、批处理</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>1、当需要成批插入或者更新记录时。可以采用Java的批量更新机制，这一机制荀彧多条语句一次性提交给数据库批量处理。通常情况下比单独提交处理更有效率。</p>
<p>2、JDBC的批量处理语句包括以下方法：<br>    addBatch()：添加需要批量处理的SQL语句或参数</p>
<p>​	executeBatch()：执行批量处理语句</p>
<p>​	clearBatch：清空批处理包的语句</p>
<p>3、JDBC连接mysql时，如果要使用批处理功能，请在url中加参数  </p>
<p>?<strong>rewriteBatchedStatements&#x3D;true</strong></p>
<p>4、批处理往往和PreparedStatement一起搭配使用，可以既减少编译次数，有减少运行次数，效率大大提高。</p>
<h3 id="示例程序-4"><a href="#示例程序-4" class="headerlink" title="示例程序"></a>示例程序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.utils.JDBCUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Batch_</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加5000条记录</span></span><br><span class="line"><span class="comment">     * 不使用批处理的传统方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">noBatch</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line">        String sql=<span class="string">&quot;insert into admin2 values (null,?,?)&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;开始执行&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5000</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>,<span class="string">&quot;jack&quot;</span>+i);</span><br><span class="line">            preparedStatement.setString(<span class="number">2</span>,<span class="string">&quot;666&quot;</span>);</span><br><span class="line">            preparedStatement.executeUpdate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;传统的方式 耗时：&quot;</span>+(end-start));<span class="comment">//传统的方式 耗时：7892</span></span><br><span class="line">        JDBCUtils.close(<span class="literal">null</span>,preparedStatement,connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加5000条记录</span></span><br><span class="line"><span class="comment">     * 使用批处理的传统方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useBatch</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtils.getConnection();</span><br><span class="line">        String sql=<span class="string">&quot;insert into admin2 values (null,?,?)&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;开始执行&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5000</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>,<span class="string">&quot;jack&quot;</span>+i);</span><br><span class="line">            preparedStatement.setString(<span class="number">2</span>,<span class="string">&quot;666&quot;</span>);</span><br><span class="line">            <span class="comment">//将sql语句加入到批处理包</span></span><br><span class="line">            preparedStatement.addBatch();</span><br><span class="line">            <span class="comment">//当有1000条记录时，再批量执行</span></span><br><span class="line">            <span class="keyword">if</span> ((i+<span class="number">1</span>)%<span class="number">1000</span>==<span class="number">0</span>) &#123;</span><br><span class="line">                preparedStatement.executeBatch();</span><br><span class="line">                preparedStatement.clearBatch();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;批处理的方式 耗时：&quot;</span>+(end-start));<span class="comment">//批处理的方式 耗时：134</span></span><br><span class="line">        JDBCUtils.close(<span class="literal">null</span>,preparedStatement,connection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="addBatch源码解读"><a href="#addBatch源码解读" class="headerlink" title="addBatch源码解读"></a>addBatch源码解读</h3><p>1、进入addBatch方法</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194306951.png"></p>
<p>2、来到CilentPreparedStatement类的addBatch</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194408869.png"></p>
<p>3、来到AbstractQuery类的addBatch方法，判断batchArgs是否为空，当进行第一次循环时，可以看到下方Watches里的batchedArgs为null，那么创建一个ArrayList</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194638729.png"></p>
<p>可以看到此刻batchedArgs已经创建好，但还未添加元素，所以size&#x3D;0</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404194916147.png"></p>
<p>4、来到ArrayList类添加元素后，可以看到elementData多出了一个元素，点进去看它的bindValuew有两个，分别对应每一条sql语句要添加的两个参数username和password。此时注意到elementData的最大容量为10</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404195046149.png"></p>
<p>5、来到第十一次循环，即i&#x3D;10的时候，进入ArrayList类的add方法，可以看到会判断当前elementData的元素个数是否与最大容量相等，若相等则调用grow()方法扩容</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/image-20220404195555654.png"></p>
<p>可以看到此时elementData的最大容量已经被扩充到了15</p>
<h2 id="6、连接池"><a href="#6、连接池" class="headerlink" title="6、连接池"></a>6、连接池</h2><h3 id="传统获取Connection弊端分析"><a href="#传统获取Connection弊端分析" class="headerlink" title="传统获取Connection弊端分析"></a>传统获取Connection弊端分析</h3><p>1、传统的JDBC数据库连接使用<strong>DriverManager</strong>来获取，每次向数据库建立连接的时候都要将Connection加载到内存中，再验证<strong>IP地址，用户名和密码</strong>（0.05s~1s）（取决于并发量和网络）。需要数据库连接的时候，就向数据库要求一个，频繁的进行数据库连接操作将占用很多的系统资源，容易造成服务器崩溃。</p>
<p>2、每一次数据库连接，使用完后都得断开，如果程序出现异常而未能关闭，将导致数据库<strong>内存泄漏</strong>，最终将导致重启数据库。</p>
<p>3、传统获取连接的方式，<strong>不能控制创建的连接数量</strong>，如果连接过多，也可能导致内存泄漏，MySQL崩溃。</p>
<p>4、解决传统开发中的数据库连接问题，可以采用<strong>数据库连接池技术（connection pool）</strong>。这意味着数据库连接在物理上并未被关闭，而是保留在一个队列中被反复重用。</p>
<p>连接池是一种非常重要的服务，JDBC规范为实现者提供了用以实现连接池服务的手段。不过JDK本身并未实现这项服务，数据库供应商提供的JDBC驱动程序中通常也不包含这项服务。相反，Web容器和应用服务器的开发商通常会提供连接池服务的实现。</p>
<h3 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h3><h4 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>1、预先在缓冲池中放入一定数量的连接，当需要建立数据库连接是，只需从“缓冲池”中取出一个，使用完毕之后再放回去。</p>
<p>2、数据库连接池负责分配、管理和释放数据库连接，它允许应用程序<strong>重复使用</strong>一个先有个数据库连接，而不是重新建立一个。</p>
<p>3、当应用程序向连接池请求的连接数超过最大连接数量是，这些请求将被加入到<strong>等待队列</strong>中。</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-04-210506.png"></p>
<h4 id="数据库连接池种类"><a href="#数据库连接池种类" class="headerlink" title="数据库连接池种类"></a>数据库连接池种类</h4><p>1、JDBC的数据库连接池使用<strong>javax.sql.DataSourse</strong>来表示，DataSourse只是一个接口，该接口通常由第三方提供实现。</p>
<p>2、<strong>C3P0</strong>数据库连接池，速度相对较慢，稳定性不错（hibernate,spring）。</p>
<p>3、DBCP数据库连接池，速度相对C3P0较快，但不稳定。</p>
<p>4、Proxool数据库连接池，由监控连接池状态的功能，稳定性较C3P0差一点。</p>
<p>5、BoneCP数据库连接池，速度快。</p>
<p>6、**Druid(德鲁伊)**是阿里提供的数据库连接池，集DBCP、C3P0、Proxool优点与一身的数据库连接池。</p>
<h3 id="德鲁伊连接池"><a href="#德鲁伊连接池" class="headerlink" title="德鲁伊连接池"></a>德鲁伊连接池</h3><h4 id="示例程序-5"><a href="#示例程序-5" class="headerlink" title="示例程序"></a>示例程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Druid_</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDruid</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/druid.properties&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个指定参数的数据库连接池</span></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">500000</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时&quot;</span>+(end-start));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写工具类"><a href="#编写工具类" class="headerlink" title="编写工具类"></a>编写工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yumo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * 基于druid数据库连接池的工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtlByDruid</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource ds;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/druid.properties&quot;</span>));</span><br><span class="line">            ds= DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在数据库连接池技术中，close 不是真的断掉连接</span></span><br><span class="line"><span class="comment">     * 而是把使用的Connection对象放回连接池(断掉引用)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet resultSet, Statement statement,Connection connection)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试代码-1"><a href="#测试代码-1" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.utils.JDBCUtlByDruid;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtilsByDruid_Use</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用druid工具类&quot;</span>);</span><br><span class="line">        <span class="comment">//得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组织一个sql</span></span><br><span class="line">        String sql=<span class="string">&quot;select * from actor&quot;</span>;</span><br><span class="line">        PreparedStatement preparedStatement=<span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//创建PreparedStatement对象</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            connection = JDBCUtlByDruid.getConnection();</span><br><span class="line">            System.out.println(connection.getClass());</span><br><span class="line">            preparedStatement=connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">            resultSet = preparedStatement.executeQuery();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">                <span class="type">Date</span> <span class="variable">borndate</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;borndate&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">                System.out.println(id+<span class="string">&quot;\t&quot;</span>+name+<span class="string">&quot;\t&quot;</span>+sex+<span class="string">&quot;\t&quot;</span>+borndate+<span class="string">&quot;\t&quot;</span>+phone);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtlByDruid.close(resultSet,preparedStatement,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Apache-DBUtils"><a href="#Apache-DBUtils" class="headerlink" title="Apache-DBUtils"></a>Apache-DBUtils</h3><h4 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h4><p>1、结果集和connection是关联的，即如果关闭连接，就不能使用结果集。</p>
<p>2、结果集不利于数据管理（只能用一次）</p>
<p>3、使用返回信息页不方便</p>
<p>解决办法：将数据库表中的每一条记录都封装为一个类，并将每一个该类对象放入到ArrayList集合。例如：</p>
<p>将actor表的每一条记录映射为一个Actor对象</p>
<p>class Actor{</p>
<p>​	属性：id,name,sex,borndate,phone</p>
<p>}，一个Actor对象对应一条actor记录</p>
<p>然后封装到ArrayList&lt; Actor &gt;</p>
<h4 id="传统封装"><a href="#传统封装" class="headerlink" title="传统封装"></a>传统封装</h4><h5 id="示例程序-6"><a href="#示例程序-6" class="headerlink" title="示例程序"></a>示例程序</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 土方法封装</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectToArrayList</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;使用druid工具类&quot;</span>);</span><br><span class="line">    <span class="comment">//得到连接</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//组织一个sql</span></span><br><span class="line">    String sql=<span class="string">&quot;select * from actor&quot;</span>;</span><br><span class="line">    PreparedStatement preparedStatement=<span class="literal">null</span>;</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">    ArrayList&lt;Actor&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Actor&gt;();</span><br><span class="line">    <span class="comment">//创建PreparedStatement对象</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        connection = JDBCUtlByDruid.getConnection();</span><br><span class="line">        System.out.println(connection.getClass());</span><br><span class="line">        preparedStatement=connection.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        resultSet = preparedStatement.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (resultSet.next())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">            <span class="type">Date</span> <span class="variable">borndate</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;borndate&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">            <span class="comment">//把得到的resultSet 的记录封装到Actor对象，放入list集合</span></span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">Actor</span>(id,name,sex,borndate,phone));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;list集合数据：&quot;</span>+list);</span><br><span class="line">        <span class="keyword">for</span>(Actor actor:list)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;id=&quot;</span>+actor.getId()+<span class="string">&quot;\t&quot;</span>+actor.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e)</span><br><span class="line">    &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtlByDruid.close(resultSet,preparedStatement,connection);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Actor对象与actor表的记录对应</span></span><br><span class="line"><span class="comment"> * =&gt; JavaBean,pojo,Domain,entity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Actor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> Date borndate;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Actor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//反射需要</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\nActor&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, sex=&#x27;&quot;</span> + sex + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, borndate=&quot;</span> + borndate +</span><br><span class="line">                <span class="string">&quot;, phone=&#x27;&quot;</span> + phone + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Actor</span><span class="params">(Integer id, String name, String sex, Date borndate, String phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">        <span class="built_in">this</span>.borndate = borndate;</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSex</span><span class="params">(String sex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBorndate</span><span class="params">(Date borndate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.borndate = borndate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getBorndate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> borndate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Apache-DBUtils介绍"><a href="#Apache-DBUtils介绍" class="headerlink" title="Apache-DBUtils介绍"></a>Apache-DBUtils介绍</h3><p>1、commons-dbuutils是Apache组织提供的一个开源JDBC工具类库，它是对JDBC的封装，使用dbutils能极大简化jdbc编码的工作量。</p>
<ul>
<li><p>DbUtils类</p>
<p>1、QueryRunner类：该类封装了SQL的执行，是线程安全的。可以实现增删改查和批处理。</p>
<p>2、使用QueryRunner类实现查询</p>
<p>3、ResultSetHandler接口：该接口用于处理java.sql.ResultSet，将数据按要求转换为另一种形式。</p>
<ul>
<li>ArrayHandler：把结果集中的第一行数据转成对象数组。</li>
<li>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中。</li>
<li>BeanHandler：将结果集中的第一行数据封装到一个对应的JavaBean实例中。</li>
<li>BeanListHandler：将结果集中的每一行数据都封装到一个对应的JavaBean实例中，存放到List里。</li>
<li>ColumnListHandler：将结果集中某一列的数据存放到List中。</li>
<li>KeyedHandler(name)：将结果集中的每行数据都封装到Map里，再把这些map存到一个map里，其key为指定的key。</li>
<li>MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value是对应的值。</li>
<li>MapListHandler：将结果集中的每一行数据都封装到一个Map里，然后再存放到List。</li>
</ul>
</li>
</ul>
<h4 id="示例程序-7"><a href="#示例程序-7" class="headerlink" title="示例程序"></a>示例程序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.utilstest;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.Actor;</span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.utils.JDBCUtlByDruid;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBUtils_Use</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//使用apache-DBUtils 工具类 + druid 完成对表的crud操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">//1、得到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtlByDruid.getConnection();</span><br><span class="line">        <span class="comment">//2、使用DBUtils类和接口,引入相关的依赖</span></span><br><span class="line">        <span class="comment">//3、创建QueryRunner</span></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//4、就可以执行相关的方法，返回ArrayList结果集</span></span><br><span class="line">        String sql=<span class="string">&quot;select * from actor where id &gt;=?&quot;</span>;</span><br><span class="line">        <span class="comment">//（1）query方法就是执行sql语句，并返回resultSet封装到ArrayList结婚中</span></span><br><span class="line">        <span class="comment">//（2）集合</span></span><br><span class="line">        <span class="comment">//（3）connection：连接</span></span><br><span class="line">        <span class="comment">//（4）sql：执行的sql语句</span></span><br><span class="line">        <span class="comment">//（5）new BeanListHandler&lt;&gt;(Actor.class)：在将resultSet-&gt;Actor对象封装到ArrayList</span></span><br><span class="line">        <span class="comment">//底层使用反射机制取获取Actor类的属性，然后进行封装</span></span><br><span class="line">        <span class="comment">//（6）1 就是给sql语句中的 ? 赋值，可以有多个值，因为是可变参数 Object... params</span></span><br><span class="line">        <span class="comment">//（7）底层得到的resultSet会在query关闭，关闭PreparedStatement</span></span><br><span class="line">        List&lt;Actor&gt; list = queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(Actor.class), <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;输出集合的信息&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Actor actor:list)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(actor);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//演示apache-dbutils + druid完成返回的结果是单行记录（单个Actor对象）</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQuerySingle</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtlByDruid.getConnection();</span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//返回单个Actor对象</span></span><br><span class="line">        String sql=<span class="string">&quot;select *from actor where id=?&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Actor</span> <span class="variable">actor</span> <span class="operator">=</span> queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(Actor.class), <span class="number">1</span>);</span><br><span class="line">        System.out.println(actor);</span><br><span class="line"></span><br><span class="line">        JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//演示apache-dbutils + druid 完成查询结果是单行单列-返回的就是Object</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testScalar</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtlByDruid.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//返回单行单列</span></span><br><span class="line">        String sql=<span class="string">&quot;select name from actor where id=?&quot;</span>;</span><br><span class="line">        <span class="comment">//返回一个Object对象，使用ScalarHandler</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">query</span> <span class="operator">=</span> queryRunner.query(connection, sql, <span class="keyword">new</span> <span class="title class_">ScalarHandler</span>&lt;&gt;(), <span class="number">1</span>);</span><br><span class="line">        System.out.println(query);</span><br><span class="line">        JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//演示apache-dbutils + druid 完成dml（update，insert，delete）</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDML</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> JDBCUtlByDruid.getConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">        <span class="comment">//完成update,insert,delete</span></span><br><span class="line"><span class="comment">//        String sql=&quot;update actor set name = ? where id = ?&quot;;</span></span><br><span class="line"><span class="comment">//        String sql=&quot;insert into actor values (null,?,?,?,?)&quot;;</span></span><br><span class="line">        String sql=<span class="string">&quot;delete from actor where id = ?&quot;</span>;</span><br><span class="line">        <span class="comment">//（1）执行dml操作时queryRunner.update()</span></span><br><span class="line">        <span class="comment">//（2）返回的值是受影响的行数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">affectedRow</span> <span class="operator">=</span> queryRunner.update(connection, sql, <span class="number">2</span>);</span><br><span class="line">        System.out.println(affectedRow&gt;<span class="number">0</span>?<span class="string">&quot;执行成功&quot;</span>:<span class="string">&quot;执行没有影响到表&quot;</span>);</span><br><span class="line"></span><br><span class="line">        JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; T <span class="title function_">query</span><span class="params">(Connection conn, <span class="type">boolean</span> closeConn, String sql, ResultSetHandler&lt;T&gt; rsh, Object... params)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="string">&quot;Null connection&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sql == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (closeConn) &#123;</span><br><span class="line">            <span class="built_in">this</span>.close(conn);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="string">&quot;Null SQL statement&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rsh == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (closeConn) &#123;</span><br><span class="line">            <span class="built_in">this</span>.close(conn);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="string">&quot;Null ResultSetHandler&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stmt = <span class="built_in">this</span>.prepareStatement(conn, sql);</span><br><span class="line">            <span class="built_in">this</span>.fillStatement(stmt, params);</span><br><span class="line">            rs = <span class="built_in">this</span>.wrap(stmt.executeQuery());</span><br><span class="line">            result = rsh.handle(rs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException var33) &#123;</span><br><span class="line">            <span class="built_in">this</span>.rethrow(var33, sql, params);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.close(rs);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.close(stmt);</span><br><span class="line">                <span class="keyword">if</span> (closeConn) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.close(conn);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建PreparedStatement</p>
<p>​	stmt &#x3D; this.prepareStatement(conn, sql);</p>
<p>对sql进行 ? 赋值</p>
<pre><code> this.fillStatement(stmt, params);
</code></pre>
<p>执行sql，返回resultSet</p>
<p>​	 rs &#x3D; this.wrap(stmt.executeQuery());</p>
<p>返回的resultSet —&gt; ArrayList&lt; result &gt;</p>
<p>​	result &#x3D; rsh.handle(rs);</p>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>java.sql.SQLException: Cannot set borndate: incompatible types, cannot convert java.time.LocalDateTime to java.util.Date Query: select *from actor where id&#x3D;? Parameters: [1]</p>
<p>执行以上代码时发现异常</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-05-183425.png"></p>
<p>原因：mysql-connector-java8.0.28中，<strong>apache-dbutils</strong>对mysql数据库中的<strong>datetime</strong>类型数据<strong>映射</strong>为<strong>LocalDateTime</strong>类型，以前版本会转换成<strong>java.util.Date</strong>类型；同时ResultSet的getDate方法返回的是java.util.Date方法。</p>
<p>解决办法：将Actor类中的Date类对象改为LocalDateTime</p>
<p>同时对其他地方的代码例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">borndate</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;borndate&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LocalDateTime</span> <span class="variable">borndate</span> <span class="operator">=</span> resultSet.getDate(<span class="string">&quot;borndate&quot;</span>).toInstant().atZone(ZoneId.systemDefault()).toLocalDateTime();</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：int，double等在Java中都用包装类，因为mysql中的所有类型都有可能是NULL，而Java只有引用数据类型才有NULL值</p>
</blockquote>
<p>发散：mysql中的其他时间类数据类型在Java中会被映射成什么，同上操作，可得以下结果：</p>
<p>date-java.sql.Date</p>
<p>time-java.sql.Time</p>
<p>year-java.sql.Date</p>
<p>timestamp-java.sql.TimeStamp</p>
<h3 id="BasicDao"><a href="#BasicDao" class="headerlink" title="BasicDao"></a>BasicDao</h3><p>问题分析</p>
<p>apache-dbutils+druid简化了JDBC开发，但还有不足：</p>
<ol>
<li>SQL语句是固定的，不能通过参数传入，通用性不好，需要进行改进，更方便增删改查。</li>
<li>对于select操作，如果有返回值，其返回类型不能固定，需要使用泛型。</li>
<li>将来的表很多，业务需求复杂，不可能只由一个Java类完成。</li>
</ol>
<h4 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h4><ol>
<li><strong>DAO</strong>：<strong>data access object 数据访问对象</strong></li>
<li>这样的通用类，称为BasicDao，是专门和数据库交互的，即完成对数据库（表）的crud操作。</li>
<li>在BasicDao的基础上，实现一张表对应一个Dao，更换的完成功能，比如Customer表—Customer.java类（javabean、pojo、domain）—CustomerDao.java</li>
</ol>
<p>使用如下层次结构：</p>
<p><img src="https://www.yumoyumo.top/wp-content/uploads/2022/04/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-2022-04-05-194841.png"></p>
<h4 id="示例程序-8"><a href="#示例程序-8" class="headerlink" title="示例程序"></a>示例程序</h4><p>BasicDAO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.dao_.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.dao_.utils.JDBCUtlByDruid;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yumo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * 开发BasicDAO，是其他DAO的父类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicDAO</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> QueryRunner qr=<span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开发通用的dml,针对任意的表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql,Object... parameters)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Connection connection=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection=JDBCUtlByDruid.getConnection();</span><br><span class="line">            <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> qr.update(connection, sql, parameters);</span><br><span class="line">            <span class="keyword">return</span> update;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译异常-&gt;运行异常，方便使用者抛出或捕获</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回多个对象（即查询的结果是多行），针对任意表</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql sql 语句，可以有 ?</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 传入一个类的Class对象，比如Actor.class</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameters 传入 ? 的具体的值，可以有多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 根据 Actor.class返回对应的ArrayList集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">queryMulti</span><span class="params">(String sql,Class&lt;T&gt; clazz,Object... parameters)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Connection connection=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection=JDBCUtlByDruid.getConnection();</span><br><span class="line">            <span class="keyword">return</span> qr.query(connection,sql,<span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;T&gt;(clazz),parameters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译异常-&gt;运行异常，方便使用者抛出或捕获</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询单行结果的通用方法</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">querySingle</span><span class="params">(String sql,Class&lt;T&gt; clazz,Object... parameters)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Connection connection=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection=JDBCUtlByDruid.getConnection();</span><br><span class="line">            <span class="keyword">return</span> qr.query(connection,sql,<span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;T&gt;(clazz),parameters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译异常-&gt;运行异常，方便使用者抛出或捕获</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询单行单列的方法，即返回单值的方法</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">queryScalar</span><span class="params">(String sql,Object... parameters)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Connection connection=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection=JDBCUtlByDruid.getConnection();</span><br><span class="line">            <span class="keyword">return</span> qr.query(connection,sql,<span class="keyword">new</span> <span class="title class_">ScalarHandler</span>&lt;&gt;(),parameters);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译异常-&gt;运行异常，方便使用者抛出或捕获</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JDBCUtlByDruid.close(<span class="literal">null</span>,<span class="literal">null</span>,connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Actor.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.dao_.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Actor对象与actor表的记录对应</span></span><br><span class="line"><span class="comment"> * =&gt; JavaBean,pojo,Domain,entity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Actor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime borndate;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Actor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//反射需要</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\nActor&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, sex=&#x27;&quot;</span> + sex + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, borndate=&quot;</span> + borndate +</span><br><span class="line">                <span class="string">&quot;, phone=&#x27;&quot;</span> + phone + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Actor</span><span class="params">(Integer id, String name, String sex, LocalDateTime borndate, String phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">        <span class="built_in">this</span>.borndate = borndate;</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSex</span><span class="params">(String sex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBorndate</span><span class="params">(LocalDateTime borndate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.borndate = borndate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LocalDateTime <span class="title function_">getBorndate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> borndate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ActorDAO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.dao_.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.dao_.domain.Actor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActorDAO</span> <span class="keyword">extends</span> <span class="title class_">BasicDAO</span>&lt;Actor&gt;&#123;</span><br><span class="line">    <span class="comment">//1、就有BasicDAO的方法</span></span><br><span class="line">    <span class="comment">//2、根据业务需求编写特有的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>testDAO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.dao_.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.dao_.dao.ActorDAO;</span><br><span class="line"><span class="keyword">import</span> javabase.jdbc.dao_.domain.Actor;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDAO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试ActorDAO对Actor表的crud</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testActorDAO</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">ActorDAO</span> <span class="variable">actorDAO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActorDAO</span>();</span><br><span class="line">        <span class="comment">//1、查询</span></span><br><span class="line">        List&lt;Actor&gt; actors = actorDAO.queryMulti(<span class="string">&quot;select * from actor where id &gt;= ?&quot;</span>, Actor.class, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;===查询结果===&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Actor actor:actors)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(actor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、查询单行记录</span></span><br><span class="line">        <span class="type">Actor</span> <span class="variable">actor</span> <span class="operator">=</span> actorDAO.querySingle(<span class="string">&quot;select * from actor where id &gt;= ?&quot;</span>, Actor.class, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;===查询单行结果===&quot;</span>);</span><br><span class="line">        System.out.println(actor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、查询单行单列</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> actorDAO.queryScalar(<span class="string">&quot;select name from actor where id &gt;= ?&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;===查询单行单列值===&quot;</span>);</span><br><span class="line">        System.out.println(o);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、dml操作</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> actorDAO.update(<span class="string">&quot;insert  actor values(null,?,?,?,?)&quot;</span>, <span class="string">&quot;张无忌&quot;</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;2020-11-11&quot;</span>, <span class="string">&quot;999&quot;</span>);</span><br><span class="line">        System.out.println(update&gt;<span class="number">0</span>?<span class="string">&quot;执行成功&quot;</span>:<span class="string">&quot;执行没有影响表&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JDBCUtilsByDruid.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javabase.jdbc.dao_.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yumo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * 基于druid数据库连接池的工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtlByDruid</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource ds;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/druid.properties&quot;</span>));</span><br><span class="line">            ds= DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在数据库连接池技术中，close 不是真的断掉连接</span></span><br><span class="line"><span class="comment">     * 而是把使用的Connection对象放回连接池(断掉引用)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(ResultSet resultSet, Statement statement,Connection connection)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (SQLException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </div>
  <script src="https://giscus.app/client.js"
        data-repo="yumoyum0/yumoyum0.github.io"
        data-repo-id="R_kgDOKZzJIg"
        data-category="Announcements"
        data-category-id="DIC_kwDOKZzJIs4CZwB8"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Archives</a></li>
        
          <li><a href="/tags/">Tags</a></li>
        
          <li><a href="/categories/">Categorys</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JDBC"><span class="toc-number">1.</span> <span class="toc-text">JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81JDBC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1、JDBC介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81JDBC%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1、JDBC驱动程序类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81JDBC%E7%9A%84%E5%85%B8%E5%9E%8B%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2、JDBC的典型用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3、结构化查询语言</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81JDBC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">2、JDBC配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8FJAR%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">驱动程序JAR文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">配置：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%BC%80%E5%90%AFMysql%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">1、开启Mysql服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81JDBC%E9%93%BE%E6%8E%A5"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2、JDBC链接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81JDBC%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.3.</span> <span class="toc-text">3、JDBC程序编写步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAconnection"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResultSet%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">ResultSet结果集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Statement%E5%92%8CSQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.3.</span> <span class="toc-text">Statement和SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PreparedStatement"><span class="toc-number">1.3.4.</span> <span class="toc-text">PreparedStatement</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-2"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC-API"><span class="toc-number">1.3.5.</span> <span class="toc-text">JDBC API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99JDBCUtils%E7%B1%BB"><span class="toc-number">1.3.6.</span> <span class="toc-text">编写JDBCUtils类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">测试代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.4.</span> <span class="toc-text">4、事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">5、批处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#addBatch%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB"><span class="toc-number">1.5.3.</span> <span class="toc-text">addBatch源码解读</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.6.</span> <span class="toc-text">6、连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E8%8E%B7%E5%8F%96Connection%E5%BC%8A%E7%AB%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.6.1.</span> <span class="toc-text">传统获取Connection弊端分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.6.2.</span> <span class="toc-text">数据库连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">基本介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%A7%8D%E7%B1%BB"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">数据库连接池种类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%B7%E9%B2%81%E4%BC%8A%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.6.3.</span> <span class="toc-text">德鲁伊连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-5"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">示例程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">编写工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">测试代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache-DBUtils"><span class="toc-number">1.6.4.</span> <span class="toc-text">Apache-DBUtils</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E5%B0%81%E8%A3%85"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">传统封装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-6"><span class="toc-number">1.6.4.2.1.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache-DBUtils%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.5.</span> <span class="toc-text">Apache-DBUtils介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-7"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">示例程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.6.5.1.1.</span> <span class="toc-text">源码分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">异常处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BasicDao"><span class="toc-number">1.6.6.</span> <span class="toc-text">BasicDao</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">基本说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%A8%8B%E5%BA%8F-8"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">示例程序</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&text=JDBC"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&is_video=false&description=JDBC"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JDBC&body=Check out this article: https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&title=JDBC"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&name=JDBC&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://username.github.io/2022/04/03/%E5%90%8E%E7%AB%AF/JDBC/&t=JDBC"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2023
    Yumo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Archives</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/categories/">Categorys</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
